<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI è¦–è¦ºç‡Ÿé¤Šå¸« | æ‹ç…§è¾¨è­˜ç‰ˆ</title>
    <style>
        :root { --primary: #27ae60; --secondary: #2980b9; --bg: #f0f2f5; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        .app-container { width: 100%; max-width: 1200px; display: flex; gap: 15px; margin: 15px; border-radius: 15px; overflow: hidden; }
        
        /* å´é‚Šæ¬„èˆ‡åŸæœ¬ç›¸åŒï¼Œç•¥ä½œç²¾ç°¡ */
        .sidebar { width: 300px; background: white; padding: 20px; display: flex; flex-direction: column; gap: 15px; box-shadow: 2px 0 10px rgba(0,0,0,0.05); overflow-y: auto; }
        .info-card { background: #f9f9f9; padding: 12px; border-radius: 10px; border-top: 4px solid var(--secondary); font-size: 0.9rem; }
        
        /* èŠå¤©ä¸»å€ */
        .chat-section { flex: 1; background: #e5ddd5; display: flex; flex-direction: column; position: relative; }
        .chat-header { background: var(--primary); color: white; padding: 15px 20px; font-weight: bold; display: flex; justify-content: space-between; }
        
        /* ç‡Ÿé¤Šå„€è¡¨æ¿ */
        .macro-bar { background: white; padding: 10px; display: flex; justify-content: space-around; border-bottom: 1px solid #ddd; text-align: center; font-size: 0.8rem; }
        .macro-remain { font-size: 1.1rem; font-weight: bold; color: var(--secondary); }

        .chat-window { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 75%; padding: 12px; border-radius: 10px; font-size: 0.95rem; }
        .user-msg { align-self: flex-end; background: #dcf8c6; }
        .ai-msg { align-self: flex-start; background: white; }
        .img-preview { max-width: 200px; border-radius: 10px; margin-top: 5px; }

        /* è¼¸å…¥å€èˆ‡åŠŸèƒ½æŒ‰éˆ• */
        .input-area { padding: 15px; background: #f0f0f0; display: flex; gap: 10px; align-items: center; }
        .input-area input { flex: 1; border: none; padding: 12px; border-radius: 20px; outline: none; }
        .icon-btn { cursor: pointer; font-size: 1.5rem; background: none; border: none; color: #555; transition: 0.3s; }
        .icon-btn:hover { color: var(--primary); }
        
        /* ç›¸æ©Ÿé®ç½©å±¤ */
        #camera-modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
        video { width: 100%; max-height: 80%; }
        .cam-controls { margin-top: 20px; display: flex; gap: 20px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="sidebar">
        <div class="info-card">
            <h3>ğŸ‘¤ å€‹äººè¨­å®š</h3>
            <input type="number" id="weight" value="70" placeholder="é«”é‡" oninput="calculatePlan()">
            <input type="number" id="target" value="65" placeholder="ç›®æ¨™é«”é‡" oninput="calculatePlan()">
            <div id="suggested" style="margin-top:10px; color: var(--secondary); font-weight:bold;"></div>
        </div>
        
    </div>

    <div class="chat-section">
        <div class="chat-header">ğŸ AI è¦–è¦ºåŠ©ç†</div>
        <div class="macro-bar">
            <div>å‰©é¤˜ç†±é‡<br><span class="macro-remain" id="remCal">--</span></div>
            <div>è›‹ç™½è³ª(g)<br><span class="macro-remain" id="remP">--</span></div>
            <div>ç¢³æ°´(g)<br><span class="macro-remain" id="remC">--</span></div>
            <div>è„‚è‚ª(g)<br><span class="macro-remain" id="remF">--</span></div>
        </div>

        <div class="chat-window" id="chatWindow">
            <div class="msg ai-msg">ä½ å¥½ï¼ä½ å¯ä»¥é»æ“Šå·¦ä¸‹è§’ã€ŒğŸ“·ã€æ‹ç…§ä¸Šå‚³æ™šé¤ï¼Œæˆ‘æœƒå¹«ä½ ä¼°ç®—ç†±é‡ã€‚</div>
        </div>

        <div id="camera-modal">
            <video id="video" autoplay></video>
            <div class="cam-controls">
                <button onclick="takePhoto()" style="background:white; color:black; padding:15px; border-radius:50%;">ğŸ“¸ æ‹æ”</button>
                <button onclick="closeCamera()" style="background:red; color:white; padding:10px 20px; border-radius:10px;">å–æ¶ˆ</button>
            </div>
        </div>

        <div class="input-area">
            <button class="icon-btn" onclick="openCamera()">ğŸ“·</button>
            <input type="text" id="userInput" placeholder="æˆ–æ‰‹å‹•è¼¸å…¥é£Ÿç‰©..." onkeypress="if(event.keyCode==13) handleText()">
            <button onclick="handleText()" style="background:var(--primary); color:white; border:none; border-radius:20px; padding:8px 20px;">ç™¼é€</button>
        </div>
        <canvas id="canvas" style="display:none;"></canvas>
    </div>
</div>

<script>
    let goals = { cal: 2000, p: 120, c: 200, f: 50 };
    let current = { cal: 0, p: 0, c: 0, f: 0 };

    // 1. ç›¸æ©ŸåŠŸèƒ½
    async function openCamera() {
        const modal = document.getElementById('camera-modal');
        const video = document.getElementById('video');
        modal.style.display = 'flex';
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
    }

    function closeCamera() {
        const video = document.getElementById('video');
        const stream = video.srcObject;
        if (stream) stream.getTracks().forEach(track => track.stop());
        document.getElementById('camera-modal').style.display = 'none';
    }

    function takePhoto() {
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        
        const dataUrl = canvas.toDataURL('image/png');
        closeCamera();
        addMessageWithImage("æ­£åœ¨åˆ†æåœ–ç‰‡ä¸­çš„é£Ÿç‰©...", dataUrl);
        
        // æ¨¡æ“¬ AI è¾¨è­˜åˆ†æ
        setTimeout(() => {
            simulateAIAnalysis("åœ–ç‰‡å…§å®¹è¾¨è­˜ç‚ºï¼šã€èˆ’è‚¥é›èƒ¸è‚‰é¤ç›’ã€‘ã€‚");
        }, 1500);
    }

    // 2. æ¨¡æ“¬åˆ†æé‚è¼¯
    function simulateAIAnalysis(prefix) {
        const mockCal = 450, mockP = 35, mockC = 40, mockF = 12;
        current.cal += mockCal; current.p += mockP; current.c += mockC; current.f += mockF;
        
        const feedback = `${prefix}\nä¼°ç®—ï¼š${mockCal}å¤§å¡ (P:${mockP}g / C:${mockC}g / F:${mockF}g)ã€‚å·²è‡ªå‹•æ‰£é™¤é¡åº¦ã€‚`;
        addMessage(feedback, 'ai-msg');
        updateUI();
    }

    function handleText() {
        const input = document.getElementById('userInput');
        if (!input.value) return;
        addMessage(input.value, 'user-msg');
        simulateAIAnalysis(`æ‰‹å‹•è¼¸å…¥è¨˜éŒ„æˆåŠŸï¼š${input.value}ã€‚`);
        input.value = "";
    }

    function addMessage(text, className) {
        const win = document.getElementById('chatWindow');
        const d = document.createElement('div');
        d.className = 'msg ' + className;
        d.innerText = text;
        win.appendChild(d);
        win.scrollTop = win.scrollHeight;
    }

    function addMessageWithImage(text, src) {
        const win = document.getElementById('chatWindow');
        const d = document.createElement('div');
        d.className = 'msg user-msg';
        d.innerHTML = `<div>${text}</div><img src="${src}" class="img-preview">`;
        win.appendChild(d);
        win.scrollTop = win.scrollHeight;
    }

    function calculatePlan() {
        const w = document.getElementById('weight').value;
        goals.cal = w * 25;
        goals.p = w * 1.8;
        goals.f = (goals.cal * 0.25) / 9;
        goals.c = (goals.cal - (goals.p * 4) - (goals.f * 9)) / 4;
        updateUI();
    }

    function updateUI() {
        document.getElementById('suggested').innerText = `ç›®æ¨™ï¼š${Math.round(goals.cal)} kcal`;
        document.getElementById('remCal').innerText = Math.round(goals.cal - current.cal);
        document.getElementById('remP').innerText = Math.round(goals.p - current.p);
        document.getElementById('remC').innerText = Math.round(goals.c - current.c);
        document.getElementById('remF').innerText = Math.round(goals.f - current.f);
    }

    calculatePlan();
</script>
</body>
</html>
