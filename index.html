<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ è–èª• 18 æ ¼ç²¾ç¢ºè½‰ç›¤ ğŸ</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0;
            background: radial-gradient(circle, #1a472a 0%, #0d2b1a 100%);
            color: #fff; font-family: "Microsoft JhengHei", sans-serif; overflow: hidden;
        }
        .snowflake { position: absolute; top: -10px; color: white; user-select: none; z-index: 1000; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(105vh) rotate(360deg); } }
        .config-section { z-index: 10; margin-bottom: 25px; padding: 20px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 20px; border: 2px solid #c41e3a; text-align: center; }
        select { padding: 10px; font-size: 1rem; border-radius: 8px; background: white; border: 2px solid #ffd700; outline: none; }
        .wheel-container { position: relative; width: 380px; height: 380px; z-index: 5; }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 35px solid #ffd700; z-index: 20; filter: drop-shadow(0 0 10px rgba(255,215,0,0.8)); }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid #ffd700; box-sizing: border-box; transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); background-color: white; box-shadow: 0 0 40px rgba(0,0,0,0.6); }
        #spin-btn { margin-top: 30px; padding: 15px 60px; font-size: 1.4rem; font-weight: bold; cursor: pointer; background: linear-gradient(45deg, #c41e3a, #ff4d4d); color: white; border: 2px solid #ffd700; border-radius: 50px; box-shadow: 0 4px 15px rgba(196, 30, 58, 0.4); transition: 0.3s; z-index: 10; }
        #spin-btn:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 0 20px #ffd700; }
        #spin-btn:disabled { filter: grayscale(1); cursor: not-allowed; }
    </style>
</head>
<body>

    <h1>ğŸ„ è–èª•äº¤æ›ç¦®ç‰© (18æ ¼ç‰ˆ) ğŸ</h1>

    <div class="config-section">
        <label><strong>ğŸ… æˆ‘æ˜¯ï¼š</strong></label>
        <select id="user-select">
            <option value="">-- è«‹é¸æ“‡åå­— --</option>
            <option value="æ€å±">æ€å±</option>
            <option value="æ˜è«º">æ˜è«º</option>
            <option value="æŸè">æŸè</option>
            <option value="èŠ·ç¶º">èŠ·ç¶º</option>
            <option value="å®›è“">å®›è“</option>
            <option value="åšæ™">åšæ™</option>
        </select>
    </div>
    
    <div class="wheel-container">
        <div class="pointer"></div>
        <canvas id="wheel" width="500" height="500"></canvas>
    </div>

    <button id="spin-btn">ğŸŒŸ æŠ½å– 3/18 çš„å¹¸é‹ ğŸŒŸ</button>

    <script>
        // é›ªèŠ±ç‰¹æ•ˆ
        function createSnow() {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            snowflake.innerHTML = 'â„';
            snowflake.style.left = Math.random() * 100 + 'vw';
            snowflake.style.animationDuration = Math.random() * 3 + 2 + 's';
            snowflake.style.opacity = Math.random();
            document.body.appendChild(snowflake);
            setTimeout(() => snowflake.remove(), 5000);
        }
        setInterval(createSnow, 150);

        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const btn = document.getElementById('spin-btn');
        const userSelect = document.getElementById('user-select');

        // å°‡ 6 äººåå–®æ“´å±•ç‚º 18 æ ¼ (æ¯äººå‡ºç¾ 3 æ¬¡ï¼Œä¸”äº¤éŒ¯æ’åˆ—)
        const baseNames = ['æ€å±', 'æ˜è«º', 'æŸè', 'èŠ·ç¶º', 'å®›è“', 'åšæ™'];
        const allSegments = [...baseNames, ...baseNames, ...baseNames]; 
        // è–èª•é…è‰²
        const colors = ['#c41e3a', '#2e7d32', '#1565c0', '#e67e22', '#8e44ad', '#2c3e50'];
        const segmentColors = [...colors, ...colors, ...colors];

        const exclusions = {
            'æ€å±': ['æ€å±', 'æ˜è«º'], 'æ˜è«º': ['æ˜è«º', 'æ€å±'],
            'æŸè': ['æŸè', 'èŠ·ç¶º'], 'èŠ·ç¶º': ['èŠ·ç¶º', 'æŸè'],
            'å®›è“': ['å®›è“', 'åšæ™'], 'åšæ™': ['åšæ™', 'å®›è“']
        };

        const totalSlices = allSegments.length; // 18
        const sliceDeg = 360 / totalSlices;
        let currentRotation = 0;

        function drawWheel() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = centerX;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < totalSlices; i++) {
                const startAngle = (i * sliceDeg - 90 - sliceDeg / 2) * Math.PI / 180;
                const endAngle = ((i + 1) * sliceDeg - 90 - sliceDeg / 2) * Math.PI / 180;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.fillStyle = segmentColors[i];
                ctx.fill();
                ctx.strokeStyle = '#ffd700';
                ctx.lineWidth = 1;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + (sliceDeg / 2) * Math.PI / 180);
                ctx.textAlign = "right";
                ctx.fillStyle = "white";
                ctx.font = "bold 16px Arial"; // 18æ ¼æ ¼å­è¼ƒå°ï¼Œå­—é«”ç¸®å°
                ctx.fillText(allSegments[i], radius - 25, 6);
                ctx.restore();
            }
        }

        function spin() {
            const currentUser = userSelect.value;
            if (!currentUser) {
                Swal.fire({ icon: 'warning', title: 'è–èª•æé†’', text: 'è«‹å…ˆé¸æ“‡èº«åˆ†ï¼', confirmButtonColor: '#c41e3a' });
                return;
            }

            btn.disabled = true;
            
            let targetIndex;
            const myExclusions = exclusions[currentUser];
            
            // éš¨æ©ŸæŠ½é¸ 0-17 ä¹‹é–“çš„ç´¢å¼•ï¼Œç›´åˆ°æŠ½åˆ°çš„åå­—ç¬¦åˆè¦å‰‡
            do {
                targetIndex = Math.floor(Math.random() * totalSlices);
            } while (myExclusions.includes(allSegments[targetIndex]));

            const stopAt = 360 - (targetIndex * sliceDeg);
            const totalRotate = currentRotation + (360 * 12) + (stopAt - (currentRotation % 360) + 360) % 360;
            
            currentRotation = totalRotate;
            canvas.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                Swal.fire({
                    title: 'ğŸ„ æŠ½åˆ°ç¦®ç‰©å›‰ï¼',
                    html: `<div style="font-size: 1.2rem;"><b>${currentUser}</b> çš„å¹¸é‹æ˜Ÿæ˜¯ï¼š<br><span style="font-size: 2.5rem; color: #c41e3a; font-weight: bold;">ğŸ ${allSegments[targetIndex]} ğŸ</span></div>`,
                    icon: 'success',
                    confirmButtonText: 'Merry Christmas!',
                    confirmButtonColor: '#2e7d32',
                    backdrop: `rgba(0,0,0,0.6)`
                });
                btn.disabled = false;
            }, 5200);
        }

        drawWheel();
        btn.addEventListener('click', spin);
    </script>
</body>
</html>
